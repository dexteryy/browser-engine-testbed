<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video codec list comparison</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="topbar">
      <h1>Video Codec and rendering path coverage｜List</h1>
      <p>Play multiple encodings and multi-resolution small windows in parallel, and observe the differences in hardware decoding, scaling and synthesis.</p>
    </header>
    <main class="page">
      <section class="toolbar">
        <div class="group">
          <span class="chip">DPR: <span id="dpr"></span></span>
          <label>filter encoding</label>
          <select id="codec-filter">
            <option value="all">all</option>
            <option value="H.264">H.264</option>
            <option value="VP9">VP9</option>
            <option value="AV1">AV1</option>
          </select>
        </div>
        <div class="group">
          <label>preload</label>
          <select id="preload">
            <option value="auto">auto</option>
            <option value="metadata">metadata</option>
            <option value="none">none</option>
          </select>
        </div>
        <div class="group">
          <label>Play rate</label>
          <input
            type="range"
            id="rate"
            min="0.5"
            max="2"
            step="0.1"
            value="1" />
          <span id="rate-label">1.0x</span>
        </div>
        <div class="group">
          <label>Preview height(px)</label>
          <input
            type="number"
            id="height"
            value="180"
            min="120"
            max="360"
            step="10" />
        </div>
        <button class="btn primary" id="play-all">allplay</button>
        <button class="btn" id="pause-all">allpause</button>
      </section>

      <section class="panel">
        <h2 class="section-title">Parallel playback window</h2>
        <p class="note">
          each &lt;video&gt; All mute, loop,playsinline;Switch encoding/preloadpost observation
          DevTools → Media codecs and color spaces.
        </p>
        <div class="grid" id="grid"></div>
      </section>

      <section class="panel explain">
        <h3 class="section-title">Instructions for use</h3>
        <div>
          1)Open DevTools →
          Media,Confirm decoder hardware/software, chroma sampling (4:2:0/4:2:2), color space.
        </div>
        <div>
          2)Performance Record 10s,Compare the main thread occupancy of different sources with GPU
          Compositing, focus on scaling/overlay Whether to render additionally.
        </div>
        <div>
          3)Check the frame drop situation when multiple instances are played simultaneously (getVideoPlaybackQuality
          droppedVideoFrames).
        </div>
      </section>
    </main>

    <script>
      const dpr = window.devicePixelRatio || 1;
      const videos = [
        {
          id: "h264-720",
          title: "H.264 720p30",
          codec: "H.264",
          res: "1280×720",
          fps: 30,
          chroma: "4:2:0",
          src: "https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
          mime: "video/mp4",
        },
        {
          id: "h264-1080",
          title: "H.264 1080p30",
          codec: "H.264",
          res: "1920×1080",
          fps: 30,
          chroma: "4:2:0",
          src: "https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4",
          mime: "video/mp4",
        },
        {
          id: "vp9-720",
          title: "VP9 720p30",
          codec: "VP9",
          res: "1280×720",
          fps: 30,
          chroma: "4:2:0",
          src: "https://test-videos.co.uk/vids/bigbuckbunny/webm/vp9/720/Big_Buck_Bunny_720_10s_1MB.webm",
          mime: "video/webm",
        },
        {
          id: "av1-1080",
          title: "AV1 1080p",
          codec: "AV1",
          res: "1920×1080",
          fps: 24,
          chroma: "4:2:0",
          src: "https://test-videos.co.uk/vids/bigbuckbunny/webm/av1/1080/Big_Buck_Bunny_1080_10s_1MB.webm",
          mime: "video/webm",
        },
      ];

      const grid = document.getElementById("grid");
      document.getElementById("dpr").textContent = dpr.toFixed(2);

      const state = {
        preload: "auto",
        rate: 1,
        height: 180,
        filterCodec: "all",
      };

      document.getElementById("preload").addEventListener("change", e => {
        state.preload = e.target.value;
        applySettings();
      });
      document.getElementById("rate").addEventListener("input", e => {
        state.rate = Number(e.target.value);
        document.getElementById(
          "rate-label",
        ).textContent = `${state.rate.toFixed(1)}x`;
        applySettings();
      });
      document.getElementById("height").addEventListener("change", e => {
        const v = Math.max(120, Math.min(360, Number(e.target.value) || 180));
        state.height = v;
        e.target.value = v;
        applySettings();
      });
      document.getElementById("codec-filter").addEventListener("change", e => {
        state.filterCodec = e.target.value;
        renderGrid();
      });
      document.getElementById("play-all").addEventListener("click", () => {
        document
          .querySelectorAll("video")
          .forEach(v => v.play().catch(() => {}));
      });
      document.getElementById("pause-all").addEventListener("click", () => {
        document.querySelectorAll("video").forEach(v => v.pause());
      });

      function renderGrid() {
        grid.innerHTML = "";
        const filtered =
          state.filterCodec === "all"
            ? videos
            : videos.filter(v => v.codec === state.filterCodec);
        filtered.forEach(v => {
          const card = document.createElement("div");
          card.className = "card";
          const video = document.createElement("video");
          video.setAttribute("playsinline", "");
          video.setAttribute("muted", "");
          video.setAttribute("loop", "");
          video.preload = state.preload;
          video.height = state.height;
          video.src = v.src;
          video.style.height = `${state.height}px`;
          video.dataset.id = v.id;
          video.playbackRate = state.rate;
          video.autoplay = true;
          const info = document.createElement("div");
          info.className = "info";
          const title = document.createElement("div");
          title.className = "title";
          title.textContent = v.title;
          const meta = document.createElement("div");
          meta.textContent = `${v.res} ｜ ${v.fps}fps ｜ ${v.codec}`;
          const badgeRow = document.createElement("div");
          badgeRow.className = "stats";
          badgeRow.innerHTML = `
          <span class="badge">chroma ${v.chroma}</span>
          <span class="badge">MIME ${v.mime}</span>
          <a class="badge" href="video-detail.html?id=${v.id}">Details/full screen</a>
        `;
          const stat = document.createElement("div");
          stat.className = "badge";
          stat.dataset.stat = v.id;
          stat.textContent = "state: -";
          info.appendChild(title);
          info.appendChild(meta);
          info.appendChild(badgeRow);
          info.appendChild(stat);
          card.appendChild(video);
          card.appendChild(info);
          grid.appendChild(card);
          video.addEventListener("loadeddata", () =>
            video.play().catch(() => {}),
          );
        });
        applySettings();
      }

      function applySettings() {
        grid.querySelectorAll("video").forEach(v => {
          v.preload = state.preload;
          v.playbackRate = state.rate;
          v.style.height = `${state.height}px`;
        });
      }

      function updateStats() {
        grid.querySelectorAll("video").forEach(v => {
          const quality = v.getVideoPlaybackQuality
            ? v.getVideoPlaybackQuality()
            : null;
          const dropped = quality ? quality.droppedVideoFrames : 0;
          const total = quality ? quality.totalVideoFrames : 0;
          const statEl = grid.querySelector(`[data-stat="${v.dataset.id}"]`);
          if (statEl) {
            statEl.textContent = `state: readyState ${v.readyState} ｜ dropped ${dropped}/${total}`;
          }
        });
        requestAnimationFrame(updateStats);
      }

      renderGrid();
      updateStats();
    </script>
  </body>
</html>
